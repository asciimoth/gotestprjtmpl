# This is an example .goreleaser.yml file with some sensible defaults.
# Make sure to check the documentation at https://goreleaser.com

# The lines below are called `modelines`. See `:help modeline`
# Feel free to remove those if you don't want/need to use them.
# yaml-language-server: $schema=https://goreleaser.com/static/schema.json
# vim: set ts=2 sw=2 tw=0 fo=cnqoj

version: 2

# before:
#   hooks:
#     # You may remove this if you don't use go modules.
#     - go mod tidy
#     # you may remove this if you don't need go generate
#     - go generate ./...

builds:
  - env:
      - CGO_ENABLED=0
    goos:
      - linux
      - windows
      #- darwin
    goarch:
      - 386
      - amd64
      - arm
      - arm64

# For macos only
# universal_binaries:
#   - replace: true

archives:
  - formats: [tar.gz]
    # this name template makes the OS and Arch compatible with the results of `uname`.
    # name_template: >-
    #   {{ .ProjectName }}_
    #   {{- title .Os }}_
    #   {{- if eq .Arch "amd64" }}x86_64
    #   {{- else if eq .Arch "386" }}i386
    #   {{- else }}{{ .Arch }}{{ end }}
    #   {{- if .Arm }}v{{ .Arm }}{{ end }}
    # use zip for windows archives
    format_overrides:
      - goos: windows
        formats: [zip]

nfpms:
  - maintainer: "{{ .Env.MAINTAINER }}"
    homepage: 'https://example.com/'
    description: Usefull tool
    license: "Apache OR MIT"
    formats:
      - deb
      - rpm
      - archlinux
    dependencies:
      - bash # For example
    recommends:
      - git # For example
    section: default

kos:
  - repositories: ["asciimoth/gotestprjtmpl"]
    tags:
      - "{{.Version}}"
      - latest
    bare: true
    preserve_import_paths: false
    platforms:
      - linux/amd64
      - linux/arm64
      - linux/arm

signs:
  - artifacts: all
    args: [ "-u", "{{ .Env.DEFAULT_GPG_FPR }}", "--output", "${signature}", "--detach-sign", "${artifact}" ]

# changelog:
#   sort: asc
#   filters:
#     exclude:
#       - "^docs:"
#       - "^test:"

release:
  # What to do with the release notes in case there the release already exists.
  mode: replace

publishers:
  - name: "GH Pages deb/rpm repo"
    cmd: "{{ .Env.MYREPO }}/maintain add {{ abs .ArtifactPath }}"

announce:
  # Requires TELEGRAM_TOKEN env var
  telegram:
    enabled: true
    chat_id: -1002950691807
    message_template: '[{{ mdv2escape .ProjectName }} {{ mdv2escape .Tag }}]({{ mdv2escape .ReleaseURL }}) is out{{ mdv2escape "!" }}'

